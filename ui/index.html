<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Governed AI Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 32px; }
    h1 { margin: 0 0 16px; color: #1a202c; }
    .sub { color: #4a5568; margin-bottom: 24px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; }
    .card { background: #fff; border-radius: 10px; padding: 18px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); border-left: 6px solid #cbd5e0; }
    .ok { border-left-color: #38a169; }
    .warn { border-left-color: #dd6b20; }
    .bad { border-left-color: #e53e3e; }
    .title { font-size: 16px; font-weight: 700; margin-bottom: 8px; color: #2d3748; }
    .row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px dashed #edf2f7; }
    .row:last-child { border-bottom: 0; }
    .k { color: #4a5568; font-weight: 600; }
    .v { color: #111827; font-weight: 700; }
    .tiny { margin-top: 10px; color: #718096; font-size: 12px; }
    .pill { display: inline-block; padding: 2px 10px; border-radius: 999px; font-size: 12px; font-weight: 700; }
    .pill-ok { background: #c6f6d5; color: #22543d; }
    .pill-warn { background: #feebc8; color: #7b341e; }
    .pill-bad { background: #fed7d7; color: #742a2a; }
    code { background: #edf2f7; padding: 2px 6px; border-radius: 6px; }
  </style>
</head>
<body>
  <h1>Governed AI Dashboard</h1>
  <div class="sub">
    Live governance + audit + cost visibility for <code>dev</code>.
  </div>

  <div class="grid">
    <div id="governance" class="card">Loading governance…</div>
    <div id="audit" class="card">Loading audit/usage…</div>
    <div id="cost" class="card">Loading cost/budget…</div>
  </div>

<script>
  const API_URL = "https://lb5k5s01q4.execute-api.us-east-1.amazonaws.com/status";

  function pill(cls, text) {
    return `<span class="pill ${cls}">${text}</span>`;
  }

  function money(n) {
    if (n === null || n === undefined) return "n/a";
    return `$${Number(n).toFixed(2)}`;
  }

  fetch(API_URL)
    .then(r => r.json())
    .then(data => {
      // --- Governance card ---
      const gov = document.getElementById("governance");
      const govClass = data.ai_enabled ? "ok" : "bad";
      const govPill = data.ai_enabled ? pill("pill-ok", "AI ENABLED") : pill("pill-bad", "AI DISABLED");

      gov.className = `card ${govClass}`;
      gov.innerHTML = `
        <div class="title">AI Governance Status ${govPill}</div>
        <div class="row"><div class="k">Environment</div><div class="v">${data.environment}</div></div>
        <div class="row"><div class="k">AI Enabled</div><div class="v">${data.ai_enabled}</div></div>
        <div class="row"><div class="k">Kill Switch Active</div><div class="v">${data.kill_switch_active}</div></div>
        <div class="row"><div class="k">Guardrails Active</div><div class="v">${data.guardrails_active}</div></div>
        <div class="tiny">Source: IAM/SSM truth via Lambda → API Gateway</div>
      `;

      // --- Audit/usage card ---
      const audit = document.getElementById("audit");
      audit.className = "card ok";
      const inv1h = data.metrics?.invocations_1h ?? data.dashboard_invocations_1h ?? 0;
      const err24h = data.metrics?.errors_24h ?? data.dashboard_errors_24h ?? 0;

      audit.innerHTML = `
        <div class="title">Audit & Usage Metrics ${pill("pill-ok", "LIVE")}</div>
        <div class="row"><div class="k">Invocations (Last 1h)</div><div class="v">${inv1h}</div></div>
        <div class="row"><div class="k">Errors (Last 24h)</div><div class="v">${err24h}</div></div>
        <div class="row"><div class="k">Last Updated (UTC)</div><div class="v">${data.last_updated_utc}</div></div>
        <div class="tiny">Source: CloudWatch metrics + runtime timestamp</div>
      `;

      // --- Cost card ---
      const cost = document.getElementById("cost");
      const c = data.cost || {};
      const burn = Number(c.burn_percentage ?? 0);
      const over = Boolean(c.over_budget);

      let costClass = "ok";
      let costPill = pill("pill-ok", "HEALTHY");
      if (burn >= 80 && burn < 100) {
        costClass = "warn";
        costPill = pill("pill-warn", "WATCH");
      }
      if (over || burn >= 100) {
        costClass = "bad";
        costPill = pill("pill-bad", "OVER BUDGET");
      }

      cost.className = `card ${costClass}`;
      cost.innerHTML = `
        <div class="title">Cost Governance ${costPill}</div>
        <div class="row"><div class="k">Monthly Budget</div><div class="v">${money(c.monthly_budget_usd)}</div></div>
        <div class="row"><div class="k">Current Spend (MTD)</div><div class="v">${money(c.current_spend_usd)}</div></div>
        <div class="row"><div class="k">Remaining Budget</div><div class="v">${money(c.remaining_budget_usd)}</div></div>
        <div class="row"><div class="k">Burn %</div><div class="v">${burn.toFixed(2)}%</div></div>
        <div class="row"><div class="k">Over Budget</div><div class="v">${over}</div></div>
        <div class="tiny">Source: AWS Cost Explorer (read-only)</div>
      `;
    })
    .catch(err => {
      document.getElementById("governance").className = "card bad";
      document.getElementById("governance").innerHTML =
        "<div class='title'>Failed to load governance data</div><div class='tiny'>Check API/CORS and Lambda logs.</div>";
      console.error(err);
    });
</script>
</body>
</html>
