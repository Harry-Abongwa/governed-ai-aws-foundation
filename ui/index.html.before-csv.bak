<!DOCTYPE html>
<html lang="en">
<head>
<style>
:root {
  --bg:#f8fafc;
  --card:#ffffff;
  --border:#e5e7eb;
  --text:#0f172a;
  --muted:#64748b;
  --primary:#2563eb;
  --success:#16a34a;
}
body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial;background:var(--bg);color:var(--text);margin:40px;}
h1{font-size:2rem;}
.card{background:var(--card);border-radius:14px;box-shadow:0 10px 25px rgba(0,0,0,.05);border:1px solid var(--border);padding:20px;margin-bottom:24px;}
table{width:100%;border-collapse:collapse;}
th{text-align:left;font-size:.75rem;letter-spacing:.05em;text-transform:uppercase;color:var(--muted);padding:10px;}
td{padding:12px 10px;border-top:1px solid var(--border);}
.badge-true{color:var(--success);font-weight:600;}
button{background:var(--primary);color:white;border:none;padding:10px 16px;border-radius:10px;font-weight:600;cursor:pointer;}
button:hover{opacity:.9;}
.actions{display:flex;justify-content:flex-end;margin-bottom:10px;}
</style>

  <meta charset="UTF-8" />
  <title>Governed AI Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, Arial, sans-serif; background:#f4f6f8; padding:30px; }
    h1 { margin-bottom:6px; }
    .sub { color:#555; margin-bottom:24px; }
    .grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(320px,1fr)); gap:16px; }
    .card { background:#fff; padding:18px; border-radius:10px; box-shadow:0 2px 6px rgba(0,0,0,.08); }
    .ok { color:#2f855a; font-weight:700; }
    .warn { color:#b7791f; font-weight:700; }
    table { width:100%; border-collapse:collapse; font-size:13px; }
    th,td { padding:6px; border-bottom:1px solid #eee; text-align:left; }
    code { background:#edf2f7; padding:2px 6px; border-radius:6px; }
  </style>
</head>
<body>

<h1>Governed AI Dashboard</h1>
<div class="sub">Live governance + audit + cost visibility for <code>dev</code></div>

<div class="grid">
  <div id="status" class="card">Loading status…</div>
  <div id="governance" class="card">Loading governance…</div>
</div>

<br/>

<div id="audit" class="card">
  <b>Audit Timeline</b>
  <div>Loading audit events…</div>
</div>

<script>
const BASE = "https://lb5k5s01q4.execute-api.us-east-1.amazonaws.com";

async function load() {
  const status = await fetch(BASE + "/status").then(r => r.json());
  const gov    = await fetch(BASE + "/governance").then(r => r.json());
  const audit  = await fetch(BASE + "/audit").then(r => r.json());

  document.getElementById("status").innerHTML = `
    <b>Status</b>
    <table>
      <tr><td>Project</td><td>${status.project}</td></tr>
      <tr><td>Environment</td><td>${status.environment}</td></tr>
      <tr><td>AI Enabled</td><td class="ok">${status.ai_enabled}</td></tr>
      <tr><td>Kill Switch</td><td>${status.kill_switch_active}</td></tr>
      <tr><td>Guardrails</td><td class="ok">${status.guardrails_active}</td></tr>
    </table>
  `;

  document.getElementById("governance").innerHTML = `
    <b>Governance Controls</b>
    <table>
      <tr><td>IAM Guardrails</td><td class="ok">${gov.governance.policy_enforcement.iam_guardrails}</td></tr>
      <tr><td>Network Restricted</td><td class="ok">${gov.governance.policy_enforcement.network_restricted}</td></tr>
      <tr><td>Data Exfil Blocked</td><td class="ok">${gov.governance.policy_enforcement.data_exfil_blocked}</td></tr>
      <tr><td>Model Access</td><td>${gov.governance.risk_posture.model_access}</td></tr>
      <tr><td>Internet Egress</td><td>${gov.governance.risk_posture.internet_egress}</td></tr>
      <tr><td>Human Override</td><td>${gov.governance.risk_posture.human_override_required}</td></tr>
    </table>
  `;

  if (!audit.audit || audit.audit.length === 0) {
    document.getElementById("audit").innerHTML += "<div>No audit events yet.</div>";
    return;
  }

  let rows = audit.audit.map(e =>
    `<tr><td>${e.event_time}</td><td>${e.actor}</td><td>${e.action}</td><td>${e.source_ip}</td></tr>`
  ).join("");

  document.getElementById("audit").innerHTML = `
    <b>Audit Timeline</b>
    <table>
      <tr><th>Time</th><th>Actor</th><th>Action</th><th>IP</th></tr>
      ${rows}
    </table>
  `;
}

load();
</script>

</body>
</html>

<hr />

<h2>Audit Events</h2>
<table border="1">
  <thead>
    <tr>
      <th>Time</th>
      <th>Action</th>
      <th>Actor</th>
      <th>Source IP</th>
    </tr>
  </thead>
  <tbody id="audit-table"></tbody>
</table>

<script>
async function loadAudit() {
  const res = await fetch("https://lb5k5s01q4.execute-api.us-east-1.amazonaws.com/audit");
  const data = await res.json();

  const table = document.getElementById("audit-table");
  table.innerHTML = "";

  data.audit.forEach(e => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${e.event_time}</td>
      <td>${e.action}</td>
      <td>${e.actor}</td>
      <td>${e.source_ip}</td>
    `;
    table.appendChild(row);
  });
}

window.onload = loadAudit;
</script>

<script>
function exportCSV() {
  fetch("https://lb5k5s01q4.execute-api.us-east-1.amazonaws.com/audit")
    .then(r => r.json())
    .then(data => {
      const rows = [["Time","Actor","Action","IP"]];
      data.audit.forEach(e => {
        rows.push([e.event_time,e.actor,e.action,e.source_ip]);
      });
      const csv = rows.map(r => r.join(",")).join("\n");
      const blob = new Blob([csv], { type: "text/csv" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "audit-events.csv";
      a.click();
      URL.revokeObjectURL(url);
    });
}
</script>
