<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Governed AI Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 32px; }
    h1 { margin-bottom: 6px; }
    .sub { color: #4a5568; margin-bottom: 24px; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 16px; }
    .card { background: #fff; border-radius: 10px; padding: 18px; box-shadow: 0 2px 6px rgba(0,0,0,0.08); border-left: 6px solid #cbd5e0; }
    .ok { border-left-color: #38a169; }
    .bad { border-left-color: #e53e3e; }
    .title { font-size: 16px; font-weight: 700; margin-bottom: 8px; }
    .row { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px dashed #edf2f7; }
    .row:last-child { border-bottom: 0; }
    .k { color: #4a5568; font-weight: 600; }
    .v { font-weight: 700; }
    .tiny { margin-top: 10px; color: #718096; font-size: 12px; }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    th, td { text-align: left; padding: 6px; border-bottom: 1px solid #edf2f7; }
    th { color: #4a5568; font-weight: 700; }
  </style>
</head>
<body>

<h1>Governed AI Dashboard</h1>
<div class="sub">Live governance + audit visibility for <code>dev</code></div>

<div class="grid">
  <div id="gov" class="card">Loading…</div>
</div>

<br/>

<div id="audit" class="card">
</body>
</html>
<script>
const BASE_API = "https://lb5k5s01q4.execute-api.us-east-1.amazonaws.com";

function pill(cls, txt) {
  return `<span class="pill ${cls}">${txt}</span>`;
}
function money(v) {
  return `$${Number(v || 0).toFixed(2)}`;
}

// -------- STATUS ----------
fetch(`${BASE_API}/status`)
  .then(r => r.json())
  .then(d => {
    const gov = document.getElementById("gov");
    gov.className = `card ${d.ai_enabled ? "ok" : "bad"}`;
    gov.innerHTML = `
      <div class="title">AI Governance ${pill("pill-ok","ENABLED")}</div>
      <div class="row"><div class="k">Environment</div><div class="v">${d.environment}</div></div>
      <div class="row"><div class="k">AI Enabled</div><div class="v">${d.ai_enabled}</div></div>
      <div class="row"><div class="k">Checked At</div><div class="v">${d.checked_at}</div></div>
      <div class="tiny">Source: Lambda runtime</div>
    `;
  });

// -------- AUDIT ----------
fetch(`${BASE_API}/audit`)
  .then(r => r.json())
  .then(d => {
    const audit = document.getElementById("audit");
    const events = Array.isArray(d.audit) ? d.audit : [];

    if (events.length === 0) {
      audit.innerHTML += `<div class="tiny">No audit events yet.</div>`;
      return;
    }

    let rows = events.map(e => `
      <tr>
        <td>${e.event_time}</td>
        <td>${e.actor}</td>
        <td>${e.action}</td>
        <td>${e.source_ip}</td>
      </tr>
    `).join("");

    audit.innerHTML = `
      <div class="title">AI Governance Audit Timeline</div>
      <table>
        <thead>
          <tr><th>Time</th><th>Actor</th><th>Action</th><th>Source IP</th></tr>
        </thead>
        <tbody>${rows}</tbody>
      </table>
      <div class="tiny">Source: API Gateway → Lambda</div>
    `;
  })
  .catch(() => {
    document.getElementById("audit").innerHTML =
      "<div class='title'>Audit load failed</div>";
  });
</script>
</body>
</html>
